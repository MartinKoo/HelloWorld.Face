using Microsoft.Extensions.Logging;
using SkiaSharp;
using System;
using System.Collections.Generic;

namespace HelloWorld.FaceService
{
    public class MyFaceService
    {
        private readonly MyFaceHelper m_FaceHelper;
        private readonly Dictionary<string, string> m_Persons;
        
        public MyFaceService(ILogger logger)
        {
            if (logger is null)
            {
                throw new ArgumentNullException(nameof(logger));
            }

            m_FaceHelper = new MyFaceHelper(logger);

            m_Persons = new Dictionary<string, string>
            {
                { "A001", "-0.04307687,-0.03596287,-0.02327023,-0.05443661,-0.02541138,-0.01702291,0.02303342,-0.03100107,-0.08881038,-0.02588297,-0.01158062,-0.06476567,0.02745033,0.03717053,0.09321393,-0.03930503,-0.09294263,-0.03941716,-0.1108805,0.001501967,-0.06297349,-0.02985168,0.03003254,0.002244082,-0.02815374,-0.007229107,0.0001872586,-0.005453871,-0.05545562,0.001072403,0.001364036,0.03207259,-0.02472368,-0.1017438,0.07147262,-0.02240037,0.05214361,0.003583002,-0.009864488,0.02002501,0.01508816,0.003893445,-0.07340048,-0.04366986,-0.03850235,0.0152088,-0.003504299,-0.002260755,0.04743577,0.03347358,-0.0437117,0.0009402178,-0.0288301,-0.07095144,-0.1387334,-0.003461466,0.05490961,-0.06383895,0.05046351,-0.002898117,-0.01474339,-0.05494433,0.008555939,0.03241412,-0.02973182,0.09777895,-0.01651604,0.0310282,-0.07532702,0.02327069,-0.0966178,-0.01951706,-0.1003614,0.05621032,-0.0316536,-0.003334031,0.06350693,-0.02305643,0.02346724,-0.002987089,0.02827708,0.02290593,-0.02213109,0.01458263,0.008896334,0.07997977,-0.02705191,0.01410084,0.01348062,-0.08055296,0.06013395,0.0929971,0.02968617,-0.09338377,-0.004126553,-0.00989493,-0.06784311,0.07879104,-0.03795655,-0.01544133,0.06108887,0.02954569,-0.08523115,0.002983828,-0.03383989,0.06050785,0.008917112,0.02596808,-0.1435261,-0.01856889,0.0980038,-0.001941023,0.004591127,0.003292554,0.0453457,0.001125729,-0.006128345,-0.01492682,-0.01116586,-0.05987317,0.01149345,-0.04802387,-0.04607879,-0.09014741,-0.04723321,-0.06574325,0.03139024,-0.008283747,0.03360271,-0.01036944,-0.05452346,-0.1008413,0.07584989,-0.03216106,-0.03740725,-0.01916515,-0.02650262,0.02916402,0.03024197,-0.08151422,0.02398748,0.03929746,-0.00256619,0.01030866,-0.001098328,0.05483465,0.02960903,0.01674956,-0.0167041,-0.05615839,-0.01940239,0.02657554,-0.001082371,0.08042323,-0.06891482,0.008852464,-0.01419248,-0.01692598,-0.02683857,0.02868246,-0.1069039,0.01068788,-0.1178079,0.01164341,0.006838529,0.07213527,-0.05274279,-0.02456182,0.04015588,-0.01896646,-0.009961667,-0.0007096885,0.01806332,-0.05083025,0.07644285,-0.0075945,0.008674296,0.02943301,0.02746655,0.008720213,-0.04068435,0.02587739,0.01121451,-0.01916836,-0.00192311,0.07741012,0.07378906,0.04133908,-0.03216746,0.009970599,9.613264E-05,-0.06670334,-0.03398795,0.02736084,-0.001379568,-0.09971891,0.03789705,-0.04242777,-0.04637791,0.003934224,-0.0002623627,-0.1048477,0.03366604,-0.06869382,-0.09772367,-0.08875855,0.003150406,-0.0082685,0.04902048,-0.002031933,0.006971179,0.1364942,0.02323991,0.00533018,0.04838099,0.009588007,-0.005225868,-0.1172261,-0.04365055,0.01030933,-0.008797649,0.010939,-0.009776235,0.01515998,-0.00113697,-0.03057146,-0.02197622,0.004082796,-0.01870713,-0.053329,0.02913954,0.01405789,-0.002079539,0.05098893,0.03390007,0.007648198,0.001871269,0.05798109,-0.07325804,0.03415497,0.007766812,-0.001582719,0.04869734,-0.0222224,-0.01987874,-0.0872773,-0.007506567,-0.01741258,0.02044171,-0.04784988,-0.0362633,-0.09042887,-0.02861039,0.03515906,0.02426943,0.07251729,0.04752213,-0.07228839,-0.004240023,0.02790884,-0.02223365,-0.02342139,-0.01419848,0.0272866,-0.01668906,0.05879406,0.005890164,-0.03182424,-0.001515055,0.009333081,-0.05326616,-0.02165549,0.000294177,0.02387325,0.004577873,0.07650562,0.07482298,-0.01182821,-0.02996842,0.006244647,-0.03733263,0.005130193,-0.07072794,-0.07523175,-0.02256904,-0.06169965,-0.009120682,-0.02910294,-0.02078157,-0.04704596,-0.003397092,0.1120618,-0.02419818,-0.007742689,-0.06002206,0.0258741,0.003883068,-0.060186,-0.01763123,-0.01739578,-0.01444421,0.07653178,-0.0004060414,-0.09571744,-0.05053582,0.00967341,-0.04623308,-0.04543995,0.00952473,0.003634338,-0.07552298,-0.04330527,0.02799029,0.02724431,-0.0001759416,-0.07384959,0.04244728,-0.1071335,0.05532087,-0.02802581,0.01582851,-0.02415824,0.0153667,-0.003408459,-0.03673932,-0.02987126,-0.007159475,-0.003450763,0.07050239,0.001325508,-0.02283688,0.1024234,0.03881595,-0.006410935,-0.008061155,-0.01782609,0.01067413,-0.02251805,-0.01485374,0.0410954,0.02858035,0.008102884,0.01236433,-0.02994451,0.007450483,0.016821,0.03307014,0.01610012,0.05169581,-0.06418382,0.04095518,0.007053365,-0.02560437,0.00974847,0.05678257,-0.008050492,-0.0210451,-0.03398581,0.0004672936,0.03663974,0.03700014,-0.03722028,-0.04500325,-0.02145417,0.05139478,-0.022192,-0.01634797,-0.01645998,-0.03872843,-0.0005023557,-0.007399034,0.005064775,0.04897488,0.01643815,0.04274793,-0.003658001,-0.003839916,-0.03792669,-0.03919531,0.02914714,-0.03283659,-0.04190557,-0.03433222,0.0529599,0.0504702,0.0423349,0.001653142,-0.004201612,0.03829462,0.006782504,-0.02565062,0.01002919,-0.0156508,0.002770311,0.02954435,-0.03625106,0.01768298,0.0004720112,0.04252655,0.01206786,0.02827425,0.003889469,-0.00223438,0.0694926,-0.005824684,-0.1165254,-0.02923271,-0.02502383,0.0665985,-0.02524295,-0.00358984,0.02922298,-0.02438295,-0.01365552,0.002937401,-0.02670945,0.04777614,-0.0001576566,0.008435257,-0.02874892,0.00723495,-0.01050029,-0.01817983,-0.04646503,-0.01409808,0.01893473,0.02031685,0.01655137,0.0002479679,-0.03142477,-0.009396717,0.01253647,-0.04329089,0.0509426,0.03248318,-0.003388154,0.06313373,-0.008917931,0.003093985,0.1187003,0.06132196,-0.07570759,-0.05862685,-0.04253919,-0.06004122,0.009305535,-0.0654504,-0.07765152,0.007904858,0.03562406,-0.01171884,-0.02138892,-0.01802243,0.01947298,-0.01188029,-0.008191384,-0.005978215,0.0001898711,-0.02357289,0.0224304,-0.1473792,-0.07317619,-0.0581495,-0.02909351,0.01473406,0.007369737,-0.003232879,0.02329348,-0.00469228,0.008178065,-0.01382966,-0.01146393,-0.02055704,0.02535255,-0.01965099,-0.00255455,-0.004012941,0.006889485,0.004068068,0.07087073,-0.03848752,0.003815901,0.07083003,0.002167895,0.1210305,-0.002935384,0.01826023,-0.08024805,-0.0932408,0.009516181,-0.0540279,-0.01479735,0.00556106,-0.05190698,0.09709253,-0.01496314,-0.01534485,0.002864436,0.01063619,-0.06716029,0.000569727,-0.000927367,0.001001848,-0.1377351,0.01323551,-0.0008193954,0.005541286,0.0194784,-0.02667896,0.04324189,-0.02619148,-0.02373755" },
                { "A002", "-0.06001416,0.09118249,-0.04557827,-0.05810543,-0.02232854,0.08808637,-0.01459992,-0.08372702,-0.04252862,-0.004049629,-0.006707439,-0.02298211,-0.04615875,-0.05731098,0.01197974,0.04704271,-0.08269273,0.02448781,-0.02073719,-0.02873665,-0.05989444,-0.07966489,-0.0552028,-0.03299692,-0.01845331,0.01130803,-0.003894107,-0.006573831,-0.0116981,0.01596343,-0.005983817,0.0403727,-0.003180771,0.06773201,0.06300115,-0.06570373,0.04530386,-0.04682526,0.007155584,-0.001962701,-0.04226701,0.0004060022,-0.05807625,-0.028616,-0.08378487,-0.03980317,-0.04105331,0.05673221,-0.01810406,0.04064105,-0.04937038,-0.03375949,-0.008908571,-0.06602094,-0.06100428,0.006327378,-0.03296067,-0.01613932,0.02957933,-0.002101477,-0.007048491,-0.04118391,0.02937637,-0.03893076,0.01667928,0.01261164,0.01170516,0.02270485,-0.009571583,0.03037008,-0.02512012,-0.06418626,-0.005916255,0.004201023,-0.02664897,0.04865088,0.006345062,0.01733188,-0.006078455,-0.01921494,0.02109621,-0.002406591,0.01788708,0.09075482,0.01226489,0.03301911,0.04162472,0.03327454,0.1016093,0.01019908,0.01020681,-0.0221613,0.04125044,-0.03590005,0.04414463,0.03108857,-0.1103109,0.03644613,0.01293131,0.03689503,0.008561493,0.05229219,-0.01287392,0.03221615,-0.06404445,0.03135589,0.02790793,0.08588686,-0.04895299,-0.02271928,0.09995233,0.02376907,-0.04168859,0.01916348,0.003971257,-0.0002499592,-0.01592329,0.007515033,0.02600471,-0.04622994,-0.005173839,-0.0174691,-0.05063322,-0.03942307,-0.02753798,0.005713667,0.01041144,0.01626588,0.02442325,0.004027878,-0.01671867,-0.04936364,0.01700263,-0.04650019,0.0580011,-0.003110121,-0.02045031,0.02933523,-0.06295376,-0.007416724,0.005856209,0.03381225,0.007914977,0.04947107,0.008287012,-0.007902614,0.04742451,-0.02304686,0.001401886,-0.05424469,-0.009262634,0.005161292,3.434014E-05,-0.005227728,0.001138822,-0.007256008,-0.07332599,0.0966664,0.0009126232,0.01062686,-0.02961151,0.04751123,-0.06620372,-0.05974045,-0.05560191,0.0723111,-0.04937987,0.0005021406,0.08484603,0.09950151,0.1019134,0.06185877,0.03248549,-0.01680944,0.04357728,-0.04789892,0.05701961,0.0149042,0.02805264,-0.009423513,0.04435733,0.05261575,-0.0260438,-0.03346911,0.0164667,0.09072547,0.01791163,0.01292368,-0.02572879,0.006209246,0.002013151,-0.06424605,-0.0293276,0.1142419,0.008153625,0.0237562,-0.01722671,0.03240309,-0.000656263,-0.06405067,-0.0005795806,-0.06692811,0.006687798,-0.05378289,-0.06652635,0.004701939,0.001100253,-0.0236333,-0.03373476,0.001674377,0.02481673,0.05141084,0.05269841,0.05164498,0.07675385,-0.01738591,0.06527615,-0.07370631,-0.004271703,0.02156376,-0.02377288,-9.718633E-05,-0.02272519,0.0812303,0.1080162,0.004502331,-0.01624055,-0.07585367,-0.03331215,0.02831919,0.00982705,0.03558471,0.1214476,0.08720224,-0.001999533,-0.01274953,-0.04984391,-0.02774298,-0.03754323,-0.004873504,0.0713098,-0.07268368,0.03027954,-0.0252974,-0.01737985,-0.02352056,0.02759217,0.02378627,-0.01594527,-0.04231228,0.05890498,-0.11259,-0.05396524,-0.009045719,-0.03737807,0.1008825,0.03003041,-0.006120505,0.00445169,0.01988568,-0.03751354,0.03643397,-0.03625005,-0.01002371,-0.01096799,0.07819104,-0.001233624,-0.01988232,0.05895027,-0.05056157,0.02259674,-0.03880459,0.002111247,0.01736591,-0.008719797,0.09563405,-0.04653854,-0.07181844,-0.08653577,0.006646866,-0.03856355,0.004016409,-0.03581662,-0.01127673,-0.100313,-0.0662144,-0.01524159,-0.006817408,-0.01495698,-0.08442943,0.02729675,0.08701839,-0.01582858,-0.07257506,-0.02682846,0.006857062,-0.004156225,0.01124465,-0.04147642,-0.03562177,-0.005245803,0.005418554,0.01505558,-0.06736194,-0.08873618,-0.0749502,-0.1178463,-0.01882704,-0.06450491,-0.01428665,-0.04968637,-0.007978047,-0.00391343,0.0290119,-0.0002271098,-0.007843955,0.04179937,0.005287552,-0.01336072,-0.05595244,0.003216356,-0.04560723,-0.001345848,0.04854267,-0.08957504,-0.04935884,-0.05741695,0.04403971,-0.01626534,0.01483572,0.1226007,0.09338719,0.0229076,0.00288517,0.03453545,-0.1054491,0.0001582479,0.0781155,0.001865253,0.06076005,0.1176453,0.005938697,0.006781735,-0.04166842,0.007781459,0.02966202,-0.008301975,-0.01433986,0.0258046,0.005809133,0.0002874869,-0.006230509,-0.08385492,-0.05056137,0.1067484,-0.0006667889,0.0237563,-0.04941093,0.01058102,0.07995042,0.02589222,-0.04503837,-0.003838758,0.02259147,-0.06385279,-0.006217771,-0.02103035,-0.03679511,-0.03789347,-0.0004513043,0.08363852,-0.007189235,0.07598851,-0.002934013,-0.01369485,-0.03961068,-0.04175118,-0.03756309,-0.06077204,0.01651091,0.09165419,-0.02286011,-0.03633974,0.007947467,0.03893161,0.02993874,0.01398181,0.0007527501,-0.01166439,-0.0719877,0.003324962,0.01182157,-0.01021277,0.03189575,-0.04326878,-0.03842147,0.02186058,0.0004979119,0.1153989,0.01618864,0.0383612,0.002827063,-0.02278474,-0.03388178,-0.07164896,-0.01380784,0.02562668,-0.00836587,0.02387143,-0.01825489,0.01501988,0.008509797,0.008986404,-0.001769583,0.02345942,-0.01641686,0.03802177,-3.049346E-05,-0.02005249,0.05742154,-0.008455526,0.07834885,-0.00316667,-0.07059978,-0.0309949,0.03048013,-0.002406734,0.0144542,-0.001638926,-0.01293009,0.01962549,0.007391325,0.03107199,0.004605275,0.0269478,-0.003866145,0.1381701,0.03072475,-0.07561895,0.02006183,0.04347165,0.02276922,-0.07754017,0.03015984,-0.03141171,0.03646248,0.006684203,-0.008986435,-0.0306174,0.03931255,-0.07787929,-0.001484949,-0.005409317,0.01554064,-0.02405036,0.001642953,-0.04111762,0.0001365661,0.01046344,0.05838703,-0.03933384,-0.0524446,0.03220831,-0.005026941,0.01284044,-0.01908865,-0.005779632,-0.04787512,-0.05481129,0.006274757,-0.02321668,-0.0702313,-0.02458754,0.02392599,-0.01453751,0.005868102,0.001864875,0.03563607,0.05941444,-0.0271959,-0.04590085,-0.02960551,0.08229434,0.0649962,0.03921105,-3.617764E-05,0.0671414,-0.01319132,-0.08031942,-0.05362042,0.02046524,-0.01862748,0.003812303,0.09251704,0.080447,-0.01731222,0.02329214,-0.04146216,-0.007161752,-0.005173278,-0.01400656,0.005073885,0.01616276,0.04598387,0.1002429,0.003981744,-0.03185048,0.04147905,-0.0145857,0.0004003601,-0.05742654,-0.03787348" }
            };
        }

        public string FindPerson(SKBitmap image)
        {
            foreach (var item in m_Persons)
            {
                if (m_FaceHelper.IsSamePerson(image, MyFaceFeatureUtil.ToArray(item.Value)))
                {
                    return item.Key;
                }
            }

            throw new Exception("未找到匹配的人员");
        }

        public string FindPerson(float[] faceFeature)
        {
            foreach (var item in m_Persons)
            {
                if (m_FaceHelper.IsSamePerson(faceFeature, MyFaceFeatureUtil.ToArray(item.Value)))
                {
                    return item.Key;
                }
            }

            throw new Exception("未找到匹配的人员");
        }
    }
}
